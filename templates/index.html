<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dental Assistant</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body>
  <h2>Dental Assistant Bot</h2>
  <textarea id="q" rows=4 cols=60 placeholder="Describe your problem (Hindi/English/Bengali)"></textarea><br/>
  <input id="loc" placeholder="Optional: city or address for nearby dentists"/><br/>
  <button id="send">Ask</button>
  <div id="out"></div>

<script>
document.getElementById("send").onclick = async () => {
  const text = document.getElementById("q").value;
  const loc = document.getElementById("loc").value;

  const res = await fetch("/ask", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({text, location: loc})
  });

  const j = await res.json();
  let html = `<h3>Language: ${j.lang}</h3>`;

  // ðŸ”¹ top-1 result
  if (j.result) {
    const t = j.result;
    html += `
      <div class="result-card">
        <div class="card-header">
          <h3>${t.names[j.lang] || t.names.en}</h3>
          <span class="score">Score: ${t.score.toFixed(2)}</span>
        </div>
        ${t.matched_symptoms && t.matched_symptoms.length ? `<p><b>Matched:</b> ${t.matched_symptoms.join(", ")}</p>` : ''}
        <p><b>Advice:</b></p>
        <ul>
          ${t.advice.map(a => `<li class="spec">${a}</li>`).join("")}
        </ul>
        <p><b>Specialist:</b> <span class="spec">${t.specialist}</span></p>
        <p><b>Urgency:</b> <span class="${t.urgency.toLowerCase()}">${t.urgency}</span></p>
      </div>`;
  } else {
    html += "<p>No relevant condition found.</p>";
  }

  // Dentists
  if (j.dentists && j.dentists.length){
    html += "<h4>Nearby dentists</h4><ul>";
    j.dentists.forEach(d => {
      html += `<li>${d.name} â€” ${d.distance_km.toFixed(2)} km</li>`;
    });
    html += "</ul>";
  }

  document.getElementById("out").innerHTML = html;
}
</script>
</body>
</html>
